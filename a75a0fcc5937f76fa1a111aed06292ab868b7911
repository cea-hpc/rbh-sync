{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "e4c4b931_8cb8e80b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1018755
      },
      "writtenOn": "2021-11-23T20:45:58Z",
      "side": 1,
      "message": "Not sure if I\u0027m supposed to review the patch as well, so very quickly:\n\n- the use of the filename to indicate a dependency on a backend doesn\u0027t sit well with me;\n- I also haven\u0027t checked in detail, but I didn\u0027t see any check to make sure mongodb is installed and running;\n- a \u003e50 lines-long bash function with a single comment at the end doesn\u0027t really make me want to do a code review;\n- also, tests in bash ðŸ˜¢\n\nBottom line: so long as this isn\u0027t made part of the CI I run by adding a `subdir(\"tests\")` in the root meson.build, I don\u0027t mind merging it, just like we did with rbh-find.\n\nPS: just so it\u0027s clear, I can do a review if you\u0027d like, I just wasn\u0027t sure if you considered the patch ready for it.",
      "revId": "a75a0fcc5937f76fa1a111aed06292ab868b7911",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1279dbd8_dbf65e8f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1018755
      },
      "writtenOn": "2021-11-23T20:52:39Z",
      "side": 1,
      "message": "\u003e PS: just so it\u0027s clear, I can do a review if you\u0027d like, I just wasn\u0027t sure if you considered the patch ready for it.\n\nHmm, after reading the history, it seems quite clear I was asked for a review.\nWill do a proper one by Friday.",
      "revId": "a75a0fcc5937f76fa1a111aed06292ab868b7911",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c4bda673_3ac54ec8",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1019048
      },
      "writtenOn": "2021-11-24T08:44:57Z",
      "side": 1,
      "message": "Regarding the filename, it is the simplest way I found to divide each type of test, because otherwise, since we\u0027re always testing rbh-sync\u0027s behaviour, there\u0027s not really any reason to make multiple test files. So basing each test file on the source and destination backends made the most sense to me.\n\nFor the check of MongoDB, the first call to rbh-sync will fail with a somewhat explicit error, so I did not think it would be necessary, but I can add a simple systemctl status on the daemon if you think it\u0027s better.\n\nRegarding the comments, I understood in other patches that adding multiple comments was not something frequently done for RBH V4, so I did not add any if it wasn\u0027t to explain something peculiar or strange.\n\nAnd as for the tests in bash, it is still the simplest way to fully test rbh-sync, both the CLI and the actual behaviour.\n\nI understand that you do not want to add these tests the CI, but we created them to verify the basics of rbh-sync (and rbh-find on the other hand) work properly. The patch 527554 was a fix for a critical bug on the mongo branching part of rbh-sync/find that had been there since September 28. These tests are not extensive or testing very specific part of the code, but they at least provide an easy way to check everything was not broken.\n\nAnd yes, as you said in the following review, I do want you to review the patch of course ðŸ˜Š",
      "parentUuid": "e4c4b931_8cb8e80b",
      "revId": "a75a0fcc5937f76fa1a111aed06292ab868b7911",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e0d34977_42c764d6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1018755
      },
      "writtenOn": "2021-11-25T22:01:25Z",
      "side": 1,
      "message": "\u003e Regarding the filename\n\nI don\u0027t mind that there is \"posix\" and \"mongo\" in the filename, I mind that meson.build uses this information to decide which dependency to check for before running the test.\n\n\u003e For the check of MongoDB, (...) I can add a simple systemctl status on the daemon if you think it\u0027s better.\n\nHmm, let\u0027s maybe leave that for a later time. The name of the systemd unit-file is distro-dependent. Same thing for the client (mongo is deprecated in favor of mongosh starting in 5.x).\n\n\u003e Regarding the comments, I understood in other patches that adding multiple comments was not something frequently done for RBH V4, so I did not add any if it wasn\u0027t to explain something peculiar or strange.\n\nFair enough\n\n\u003e And as for the tests in bash, it is still the simplest way to fully test rbh-sync, both the CLI and the actual behaviour.\n\nI think having a python wrapper for the C-API would make testing more interesting, but you\u0027re right, it\u0027s hard to test a command-line tool without running it, and bash is pretty good at launching command-line tools.\n\nThe issue with bash is that test frameworks are rare, and none of the ones I found looked particularly attractive to me. Not having a test framework means you have to take care of so many things that would be abstracted away in other contexts (setup/cleanup, parallelization, test harnesses, output format [0], ...)\n\n\u003e I understand that you do not want to add these tests the CI, but we created them to verify the basics of rbh-sync (and rbh-find on the other hand) work properly. The patch 527554 was a fix for a critical bug on the mongo branching part of rbh-sync/find that had been there since September 28. These tests are not extensive or testing very specific part of the code, but they at least provide an easy way to check everything was not broken.\n\nI do not want to add them to _my_ CI ðŸ˜Š [1]\nIf you want to run them in your own CI, by all means.\n\n[0] https://testanything.org/\n[1] this is mostly out of concern that exploits are way too easy to write in a scripting language and that I run the CI on my machine. Also afraid of a wild (non-malicious) `rm -rf /`.",
      "parentUuid": "c4bda673_3ac54ec8",
      "revId": "a75a0fcc5937f76fa1a111aed06292ab868b7911",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "cb4421cb_a7bccaf5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1019048
      },
      "writtenOn": "2021-11-29T14:17:12Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "e0d34977_42c764d6",
      "revId": "a75a0fcc5937f76fa1a111aed06292ab868b7911",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    }
  ]
}